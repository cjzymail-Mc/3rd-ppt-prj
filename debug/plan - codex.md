# 新功能实施计划：Excel 问卷解析 → 自动生成 PPT

## 1. 需求总结

用户希望读取并解析 Excel【问卷模板-1】的内容，自动生成 PPT【篮球试穿问卷PPT】。需要一个可批量处理多份问卷的智能函数，完成数据解析、图表制作、排版和导出。该功能需复用现有的 COM 自动化方式完成像素级排版与图表控制。

## 2. 现有代码库情况

基于 `repo-scan-result.md` 的扫描结果：

- **技术栈**：Python + win32com + xlwings + COM API（Windows + Office 依赖）
- **架构模式**：
  - COM 直接操控 PPT/Excel
  - 剪贴板桥接（Excel 图表/图片复制 → PPT 粘贴）
  - 硬编码坐标与相对偏移进行版式控制
- **可复用能力**：
  - 图表生成（`make_chart`）
  - 矩阵图生成（`make_matrix`）
  - 图片/文本盒子排版封装（`mc_pic`, `Text_Box` 等）

> 现有仓库未直接呈现脚本代码文件，后续开发需先确认脚本位置与版本，确保与扫描结果一致。

## 3. 实施方案

### 3.1 新增功能模块/文件（拟定）

> 具体文件路径需在确认现有脚本结构后落地；以下为规划级别。

1. **问卷解析模块**（如 `src/questionnaire_parser.py`）
   - 解析 Excel【问卷模板-1】关键工作表、问题、选项、统计指标
   - 将数据转换成可视化/排版所需的结构化对象

2. **PPT 生成编排模块**（如 `src/ppt_builder.py`）
   - 接收解析后的结构化数据
   - 调用现有图表、矩阵、文本框、图片排版工具
   - 负责页级版式与主题一致性

3. **批处理入口/主流程**（如 `src/batch_runner.py` 或主脚本新入口）
   - 扫描输入目录，批量读取多份 Excel
   - 自动命名输出 PPT
   - 错误隔离与失败报告

### 3.2 修改与复用

- **复用现有图表/排版函数**：
  - 统一对接 `make_chart`、`make_matrix`、`mc_pic` 等封装
  - 输出位置、尺寸和样式在统一的“版式配置”中管理

- **扩展模板映射**：
  - 新增/调整 `Global_var_030` 或模板配置，以适配问卷模块页、结论页
  - 保持模板页码与内容逻辑一致

### 3.3 依赖变更

- 若现有环境未包含：
  - `pywin32`、`xlwings`、`openai` 等依赖需补充
- 若批量处理需要更强健的日志记录，可考虑引入 `loguru` 或标准库 `logging`

## 4. 分步实施路径

1. **确认代码基线与模板规范**
   - 定位主脚本与核心函数文件
   - 复核 Excel【问卷模板-1】结构、PPT【篮球试穿问卷PPT】版式和内容映射

2. **定义问卷数据结构与解析规则**
   - 明确题型（单选、多选、评分、开放题）
   - 建立结构化数据模型（题目、选项、统计、描述等）

3. **设计“页面级输出规范”**
   - 明确每类内容对应的 PPT 页面类型（图表页/矩阵页/总结页等）
   - 固化坐标、字号、颜色与图表样式

4. **实现问卷解析模块**
   - 读取 Excel 关键区域
   - 输出结构化数据并校验缺失值

5. **实现 PPT 编排模块**
   - 调用现有图表/矩阵/文本函数
   - 完成页面级排版与统一主题

6. **实现批处理逻辑**
   - 支持输入目录批量生成
   - 每份问卷生成独立输出 PPT
   - 错误记录与摘要报告

7. **验收与边界校验**
   - 处理空值、异常格式、缺失题目
   - 多份问卷批量运行稳定性

## 5. 风险与注意事项

- **环境限制**：必须在 Windows 且本地安装 Office，否则 COM 无法工作。
- **剪贴板竞争**：批量生成时需避免并行执行，保证 Copy/Paste 稳定性。
- **模板一致性**：Excel 模板更新会导致解析规则失效，需版本管理。
- **性能**：大量问卷处理需优化启动 Excel/PPT 实例与图表生成策略。
- **失败容错**：单份问卷失败不应中断批处理全局流程。