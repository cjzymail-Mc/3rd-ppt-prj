# 新功能实施计划：Excel 问卷 → PPT 自动生成

## 1. 需求总结
- 读取并解析 Excel `问卷模板 - 1.xlsx` 的内容。
- 以 `ppt模板 - 1.pptx` 为模板，生成 `篮球试穿问卷ppt - 1.pptx`。
- 支持批量处理多份问卷，自动完成数据解析、图表制作、排版、PPT 导出。
- 强调“智能处理函数”，统一封装流程以便复用。

## 2. 现有代码库情况
- **技术栈**：Python + `win32com` (PPT/Excel COM) + `xlwings` (Excel 读写) + 现成的 PPT 组件/排版工具。
- **相关模块**：
  - `Main.py` 作为入口，负责 Excel/PPT 应用初始化与主流程编排。
  - `src/Function_030.py` 提供图表生成、矩阵图绘制、剪贴板粘贴等核心能力。
  - `src/Class_030.py` 封装 PPT 文本框、形状等绘制能力。
  - `src/Global_var_030.py` 存放模板页码与全局配置。
- **可复用逻辑**：图表生成与粘贴 (`make_chart`)、矩阵图绘制 (`make_matrix`)、文本/图形封装类。

## 3. 实施方案

### 3.1 新增文件（规划）
1. `src/questionnaire_parser.py`
   - 读取 `问卷模板 - 1.xlsx`，抽象成结构化数据（问卷元数据、题目、选项、统计结果）。
2. `src/ppt_renderer.py`
   - 负责将结构化数据映射到 PPT 模板页（文字替换、图表插入、图形排版）。
3. `src/batch_runner.py`
   - 支持批量输入 Excel 路径列表/目录，循环生成 PPT。

### 3.2 修改文件（规划）
1. `Main.py`
   - 直接新增“问卷 → PPT”主流程入口，并**插入到【5】实战测评与【6】结论之间**（约 790-800 行区间），保证不改变现有流程顺序。
2. `src/Function_030.py`
   - 封装/复用已有图表与绘制工具，供新渲染器调用。
3. `src/Global_var_030.py`
   - 新增模板页码、占位符标识、版式参数（标题、图表区域等）。

### 3.3 依赖与环境
- 维持现有依赖（`win32com`, `xlwings`, `openai`），不引入 `numpy` 等大型计算库。
- Excel 统计仅做**轻量处理**（均值、频次统计等），以 `xlwings`/COM 读取的数据为主。
- 评论总结调用现有 `GPT_5` 函数，仅需构造提示词，不新增 LLM 调用封装。
- 评论输出采用 **B 方案：统一一段总结放在结论页**；分页评论处理沿用 `Main.py` 现有逻辑，不重复开发。
- 最大化复用现有 PPT 模板，避免复杂线条绘制，聚焦**图表生成与排版**。

## 4. 分步实施路径
1. **梳理问卷模板结构**：确认 `问卷模板 - 1.xlsx` 的 sheet、关键字段与布局。
2. **定义数据模型**：设计问卷数据结构（基本信息、题目列表、统计结果、图表映射）。
3. **实现解析模块**：将 Excel 内容转换为统一的数据对象（可复用 `xlwings`/COM）。
4. **实现 PPT 渲染器**：
   - 文本替换：定位模板文本框并填充数据。
   - 图表生成：调用现有 `make_chart` 或新增轻量封装生成图表。
   - 排版：优先复用模板占位符与 `Class_030` 对象控制能力，减少复杂图形绘制。
5. **主流程集成**：在 `Main.py` 中添加入口，插入到【5】与【6】之间，支持单文件与批量处理。
6. **校验与回归**：
   - 使用提供的 `问卷模板 - 1.xlsx` 生成 `篮球试穿问卷ppt - 1.pptx` 对比。
   - 验证结论页统一总结内容由 `GPT_5` 生成并正确落版。
   - 验证批量处理稳定性与异常提示。

## 5. 风险与注意事项
- **COM 稳定性**：剪贴板/Excel 图表复制粘贴易受系统状态影响，需要延时与异常重试策略。
- **模板耦合**：若模板布局或占位符变更，需同步更新映射配置。
- **批量性能**：大量文件处理需考虑 Excel/PPT 进程复用与资源释放（防止内存泄漏）。
- **跨平台限制**：仅适用于 Windows + Office 环境。
